{% load static %}

<!DOCTYPE html>
<html>
<head>
  <title>Worldbank</title>
  <link rel="icon" href="https://i.postimg.cc/8P7NLtNC/worldbank-icon-modified.png" type="image/png" sizes="80x80">
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- One file includes all the Font Awesome Free icons and utilities -->
<link href="{% static 'fontawesomefree/css/all.min.css' %}" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<style>
body,h1,h2,h3,h4,h5,h6 {font-family: "Raleway", sans-serif}

body, html {
  height: 100%;
  line-height: 1.8;
  background-color: #E0E5E5	;
}

/* Full height video header */
.bgvid-1 {
  display: none; /* Hide by default */

}



@media screen and (min-width: 605px) {
  .bgvid-1 {
    display: block; /* Show on medium and large screens */
    position: relative;
    min-height: 100%;
    width: 100%;
    overflow: hidden;
  }

  .bgvid-1 video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 90%;
    object-fit: cover;
    }

  .w3-display-left, .w3-display-bottomleft {
    color: black;
  }
}

.w3-bar .w3-button {
  padding: 16px;
  color: white;
}

.w3-bar .w3-button:hover {
  background-color: transparent !important;
  color: inherit !important;
} 



.alert {
  padding: 20px;
  background-color: #026C3D;
  color: white;
}

.closebtn {
  margin-left: 15px;
  color: white;
  font-weight: bold;
  float: right;
  font-size: 22px;
  line-height: 20px;
  cursor: pointer;
  transition: 0.3s;
}

.closebtn:hover {
  color: black;
}


{% comment %} 
.container {
  display: inline-block;
  cursor: pointer;
} {% endcomment %}

.bar1, .bar2, .bar3 {
  width: 27px;
  height: 3px;
  background-color: #FEFCFF;
  margin: 4px;
  transition: 0.4s;
}

.change .bar1 {
  transform: translate(0, 7px) rotate(-45deg);
}

.change .bar2 {
  opacity: 0;
}

.change .bar3 {
  transform: translate(0, -7px) rotate(45deg);
}





  /* Sidebar on small screens when clicking the menu icon */
  .w3-sidebar.w3-bar-block.w3-card.w3-animate-left.w3-hide-medium.w3-hide-large {
    display: none;
    font-family: Verdana;
    width: 220px; /* Adjust the width as needed */
    color:#99A3A3		;
    font-size: 12px;

  }

  /* Prevent hover effect on sidebar buttons */
  .w3-sidebar.w3-bar-block.w3-card.w3-animate-left.w3-hide-medium.w3-hide-large .w3-bar-item.w3-button:hover {
    background-color: #040720 !important;
    color: white !important;
  }





  /* Dropdown button */
  .dropbtn {
    background-color: transparent;
    color: white;
    padding: 16px;
    font-size: 16px;
    border: none;
    cursor: pointer;
  }
  
  /* Dropdown content */
  .w3-dropdown-content {
    display: none;
    position: absolute;
    background-color: #F0FFFF	;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
  }
  
  /* Links inside the dropdown */
  .w3-dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
  }
  
  /* Change color of dropdown links on hover */
  .w3-dropdown-content a:hover {
    background-color: #033E3E	;
    color: white;
  }
  
  /* Show the dropdown content on hover */
  .dropdown:hover .w3-dropdown-content {
    display: block;
  }
  


  .word-with-image {
    display: inline-block;
    vertical-align: middle;
  }

  .word-with-image  {
    width: 40px; /* Adjust the width as needed */
    height: 25px; /* Maintain aspect ratio */
    margin-right: 5px; /* Space between the image and the word */
    margin-top: -8px;
  }


  .w3-panel {
    margin-top: 57px;
    height: 40px;
    font-size:16px;
    
    background-color:#FFFFFF;

  }




  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.9);
  }
  
  .modal-content {
    margin: 15% auto;
    padding: 20px;
    width: 80%;
    max-width: 600px;
    position: relative;
  }
  
  .close {
    color: black;
    position: absolute;
    top: 10px;
    right: 20px;
    font-size: 30px;
    font-weight: bold;
    cursor: pointer;
  }
  
  .close:hover {
    color: #999;
  }
  
  img {
    width: 100%;
    height: auto;
  }

  /* CSS */
  a#openModal {
    color: inherit;
    text-decoration: none;
  }
  
  a#openModal:hover {
    color: white;
  }
  


  .navtop {
    z-index: 1000;
  }



  .fant {
    text-align: right;
    margin-top: -58px;
  }
  
  
  .fanting {
    text-align: right;
    margin-top: -43px;
}
  

.class{
text-align: right;
margin-top: -42px;
}

.dot {
text-decoration: none;
font-weight: bold;
font-size: 12px;
font-family: arial;
color: #29465B	;
}


.card-img-top {
height: 150px;
}

.card89 {
height: 40px;
border-radius: 100%;
width: 36px;
margin-top: 20px; 
margin-left: -13px;
justify-content: left;
}

.navbar {
position: relative;
z-index: 0; /* Ensure navbar appears above other content */
}

.list-group {
position: relative;
border-radius: 0px;
z-index: 0; /* Ensure list group items are below navbar */
}

.list-group-item {
  background-color: #f8f9fa;
  border-color: #dee2e6;
  color: #495057;
  border-radius: 0;
}

.list-group-item:hover {
  background-color: #e9ecef;
}

.list-group-item.active {
  background-color: #007bff;
  border-color: #007bff;
  color: #fff;
}

.status-pending {
    color: #FFA500;
}

.status-successful {
    color: #08A04B; /* Green color for Successful status */
}


.status-failed {
    color: #9F000F; /* Green color for Successful status */
}



</style>
</head>
<body>

<div class="w3-top navtop">
  <div class="w3-bar  w3-card" id="myNavbar" style="background-color: #040720; color: white;">
    <a href="{% url 'base' %}" class=" w3-bar-item w3-button w3-hide-medium w3-hide-large" style=" font-weight: 900; font-family: Georgia, sans-serif; color: #FEFCFF; font-size: 13px"><i class="fa-solid fa-arrow-left"></i> Send Email <i class="fa-solid fa-envelope"></i></a>
    <a href="{% url 'base' %}" class=" w3-bar-item w3-button w3-hide-small w3-hide-large" style=" font-weight: 900; font-family: Georgia, sans-serif; color: #FEFCFF; font-size: 13px"><i class="fa-solid fa-arrow-left"></i> Send Email <i class="fa-solid fa-envelope"></i> </a>
    <a href="{% url 'base' %}" class=" w3-bar-item w3-button w3-hide-small w3-hide-medium" style=" font-weight: 900; font-family: Georgia, sans-serif; color: #FEFCFF; "><i class="fa-solid fa-arrow-left"></i> Send Email <i class="fa-solid fa-envelope"></i>   </a>
    
  </div>
</div>


{% block content %}

{% endblock  %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.4.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

  <!-- One file includes all the Font Awesome Free icons and utilities -->
  <script src="{% static 'fontawesomefree/js/all.min.js' %}"></script>

  
  <script>
    function toggleDropdown() {
      var dropdownContent = document.getElementById("dropdownContent");
      dropdownContent.classList.toggle("show");
    }
  
    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
      if (!event.target.matches('.dropbtn')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        for (var i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }
  </script>


  <script>
    function showSweetAlertModaling() {
        // Create a custom HTML content for the modal body
        const modalContent = document.createElement('div');
        modalContent.innerHTML = `
          <div style="display: flex; align-items: center;">
            <div style="flex: 1;">
              <label for="month" style="font-family: Helvetica; font-weight: bold;">Month</label>
              <select id="month" class="form-select">
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
              </select>
            </div>
            <div style="width: 10px;"></div> <!-- Small space between dropdowns -->
            <div style="flex: 1;">
              <label for="year" style="font-family: Helvetica; font-weight: bold;">Year</label>
              <select id="year" class="form-select">
                <option value="2021">2021</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
              </select>
            </div>
          </div>
        `;

        
          
    // Display the SweetAlert modal with the custom HTML content and a custom icon image
    Swal.fire({
      title: 'Select Month and Year',
      html: modalContent,
      imageUrl: '{% static 'images/cardman-modified.png' %}', // Path to your image file
      imageWidth: 100, // Width of the image
      imageHeight: 100, // Height of the image
      showCancelButton: true,
      confirmButtonText: 'Show Transactions',
      cancelButtonText: 'Cancel',
      allowOutsideClick: false, // Prevent closing the modal by clicking outside of it
      preConfirm: () => {
        const month = document.getElementById('month').value;
        const year = document.getElementById('year').value;
        // Fetch transactions for the selected month and year
        return fetch(`/api/transactions?month=${month}&year=${year}`)
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            console.log('Transactions:', data);

            // Update the DOM to display the transactions for the selected month and year
            const transactionsContainer = document.getElementById('transactions-containering');
            transactionsContainer.innerHTML = ''; // Clear previous transactions

            let totalAmount = 0; // Initialize total amount variable

            if (data.length === 0) {
              // Display a message when there are no transactions for the selected month and year
              const messageElement = document.createElement('div');
              messageElement.className = 'no-transactions-message';
              messageElement.textContent = 'No transaction history for this selected month and year.';
              messageElement.style.color = '#52595D	'; // Set the text color to red
              messageElement.style.fontFamily = 'Helvetica'; // Set the font family to Arial
              messageElement.style.fontSize = '16px'; // Set the font size to 16px
              messageElement.style.fontWeight = '900'; // Set the font size to 16px
              messageElement.style.textAlign = 'center'; // Set the font size to 16px
              messageElement.style.marginTop = '200px'; // Move the message down by 20 pixels
              transactionsContainer.appendChild(messageElement);
            } else {
              // Loop through the transactions data and create HTML elements to display them
              data.forEach(transaction => {
                const transactionElement = document.createElement('div');
                transactionElement.className = 'transaction';

                // Set the status class based on the transaction status
                let statusClass = '';
                if (transaction.status === 'Pending') {
                  statusClass = 'status-pending';
                } else if (transaction.status === 'Successful') {
                  statusClass = 'status-successful';
                } else if (transaction.status === 'Failed') {
                  statusClass = 'status-failed';
                }

                const amount = parseFloat(transaction.amount.replace(/[^\d.-]/g, '')); // Parse amount to float
                if (!isNaN(amount)) {
                  totalAmount += amount; // Add transaction amount to total
                }

                transactionElement.innerHTML = `
                <div class="list-group list-group-item list-group-item-action transaction-link" data-transaction-id="${transaction.id}" aria-current="true">
                      <img src="${transaction.image_url}" class="card89" alt="Message Image">
                      <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1 w3-hide-medium w3-hide-large" style="margin-left: 26px; margin-top: -39px; font-size: 14px; font-weight: ; font-family:Helvetica;">${transaction.Sender_Name.slice(0, 17)}...</h5>
                        <h5 class="mb-1 w3-hide-medium w3-hide-large" style="margin-right: -8px; margin-top: -39px; font-size: 14px; font-weight: 900; font-family: Helvetica">${transaction.amount}</h5>
                      </div>
                      <p class="mb-1 w3-hide-large w3-hide-medium"  style="margin-left: 30px; margin-top: -20px;"><small class="text-muted">${transaction.date}, ${transaction.time}</small></p>
                      <p class="${statusClass} w3-hide-medium w3-hide-large" style="margin-right: -7px; text-align: right; margin-top: -28px; font-weight: 900; font-family: Helvetica;">${transaction.status}</p>
                  </div>`;
                  transactionsContainer.appendChild(transactionElement);
                });
                  // Add click event listener to transaction links
                  document.addEventListener('click', (event) => {
                  const transactionLink = event.target.closest('.transaction-link');
                  if (transactionLink) {
                  event.preventDefault();
                  const transactionId = transactionLink.getAttribute('data-transaction-id');
                  window.location.href = `/transactions/${transactionId}/`;
                  }
                  });


                              }

                    
                  // Display total amount
                  if (month && year) {
                    // Hide the static total amount
                    document.getElementById('staticTotalAmount').style.display = 'none';
                    // Show the dynamic total amount with placeholder
                    document.getElementById('dynamicTotalAmount').style.display = 'inline';
                    const totalAmountText = totalAmount.toFixed(2);
                    document.getElementById('totalAmountPlaceholder').textContent = totalAmountText;
                  } else {
                    // Show the static total amount
                    document.getElementById('staticTotalAmount').style.display = 'inline';
                    // Hide the dynamic total amount
                    document.getElementById('dynamicTotalAmount').style.display = 'none';
                  }

        
                  })
          .catch(error => {
            console.error('Error fetching transactions:', error);
            // Handle the error gracefully, e.g., display an error message to the user
          });
  }
});

      }
    </script>

    
<script>
  function showSweetAlertModal() {
      // Create a custom HTML content for the modal body
      const modalContent = document.createElement('div');
      modalContent.innerHTML = `
        <div style="display: flex; align-items: center;">
          <div style="flex: 1;">
            <label for="month" style="font-family: Helvetica; font-weight: bold;">Month</label>
            <select id="month" class="form-select">
              <option value="1">January</option>
              <option value="2">February</option>
              <option value="3">March</option>
              <option value="4">April</option>
              <option value="5">May</option>
              <option value="6">June</option>
              <option value="7">July</option>
              <option value="8">August</option>
              <option value="9">September</option>
              <option value="10">October</option>
              <option value="11">November</option>
              <option value="12">December</option>
            </select>
          </div>
          <div style="width: 10px;"></div> <!-- Small space between dropdowns -->
          <div style="flex: 1;">
            <label for="year" style="font-family: Helvetica; font-weight: bold;">Year</label>
            <select id="year" class="form-select">
              <option value="2021">2021</option>
              <option value="2022">2022</option>
              <option value="2023">2023</option>
              <option value="2024">2024</option>
            </select>
          </div>
        </div>
      `;
  
      // Display the SweetAlert modal with the custom HTML content and a custom icon image
      Swal.fire({
          title: 'Select Month and Year',
          html: modalContent,
          imageUrl: '{% static 'images/cardman-modified.png' %}', // Path to your image file
          imageWidth: 100, // Width of the image
          imageHeight: 100, // Height of the image
          showCancelButton: true,
          confirmButtonText: 'Show Transactions',
          cancelButtonText: 'Cancel',
          allowOutsideClick: false, // Prevent closing the modal by clicking outside of it
          preConfirm: () => {
              const month = document.getElementById('month').value;
              const year = document.getElementById('year').value;
              // Fetch transactions for the selected month and year
              return fetch(`/api/transactions?month=${month}&year=${year}`)
                  .then(response => {
                      if (!response.ok) {
                          throw new Error('Network response was not ok');
                      }
                      return response.json();
                  })
                  .then(data => {
                      console.log('Transactions:', data);
  
                      // Update the DOM to display the transactions for the selected month and year
                      const transactionsContainer = document.getElementById('transactions-container');
                      transactionsContainer.innerHTML = ''; // Clear previous transactions
  
                      let totalAmount = 0; // Initialize total amount variable
  
                      if (data.length === 0) {
                          // Display a message when there are no transactions for the selected month and year
                          const messageElement = document.createElement('div');
                          messageElement.className = 'no-transactions-message';
                          messageElement.textContent = 'No transaction history for this selected month and year.';
                          messageElement.style.color = '#52595D'; // Set the text color to red
                          messageElement.style.fontFamily = 'Helvetica'; // Set the font family to Arial
                          messageElement.style.fontSize = '16px'; // Set the font size to 16px
                          messageElement.style.fontWeight = '900'; // Set the font size to 16px
                          messageElement.style.textAlign = 'center'; // Set the font size to 16px
                          messageElement.style.marginTop = '200px'; // Move the message down by 20 pixels
                          transactionsContainer.appendChild(messageElement);
                      } else {
                          // Loop through the transactions data and create HTML elements to display them
                          data.forEach(transaction => {
                              const transactionElement = document.createElement('div');
                              transactionElement.className = 'transaction';
  
                              // Set the status class based on the transaction status
                              let statusClass = '';
                              if (transaction.status === 'Pending') {
                                  statusClass = 'status-pending';
                              } else if (transaction.status === 'Successful') {
                                  statusClass = 'status-successful';
                              } else if (transaction.status === 'Failed') {
                                  statusClass = 'status-failed';
                              }
  
                              const amount = parseFloat(transaction.amount.replace(/[^\d.-]/g, '')); // Parse amount to float
                              if (!isNaN(amount)) {
                                  totalAmount += amount; // Add transaction amount to total
                              }
  
                              
                              transactionElement.innerHTML = `
                              <div class="list-group list-group-item list-group-item-action transaction-link" data-transaction-id="${transaction.id}" aria-current="true">
                                <img src="${transaction.image_url}" class="card89" alt="Message Image">
                                    <div class="d-flex w-100 justify-content-between">
                                      <h5 class="mb-1 w3-hide-small" style="margin-left: 30px; margin-top: -43px;  font-family:Helvetica;">${transaction.Sender_Name.slice(0, 45)}</h5>
                                      <h5 class="mb-1 w3-hide-small" style="margin-right: -8px; margin-top: -44px; font-family:Helvetica ; font-weight: 900;">${transaction.amount}</h5>
                                    </div>
                                    <p class="mb-1 w3-hide-small"  style="margin-left: 30px; margin-top: -20px;"><small class="text-muted">${transaction.date}, ${transaction.time}</small></p>
                                    <p class="${statusClass} w3-hide-small" style="margin-right: -7px; text-align: right; margin-top: -30px; font-weight: 900; font-family: Helvetica;">${transaction.status}</p>
                                  
                                </div>`;
                              transactionsContainer.appendChild(transactionElement);
                          });
                        // Add click event listener to transaction links
                        document.addEventListener('click', (event) => {
                          const transactionLink = event.target.closest('.transaction-link');
                          if (transactionLink) {
                              event.preventDefault();
                              const transactionId = transactionLink.getAttribute('data-transaction-id');
                              window.location.href = `/transactions/${transactionId}/`;
                          }
                        });

                                              }
                          

                                              
                                // Display total amount
                        if (month && year) {
                          // Hide the static total amount
                          document.getElementById('totalAmountStatic').style.display = 'none';
                          // Show the dynamic total amount with placeholder
                          document.getElementById('totalAmountDynamic').style.display = 'inline';
                          const totalAmountText = totalAmount.toFixed(2);
                          document.getElementById('totalAmountPlaceholdering').textContent = totalAmountText;
                        } else {
                          // Show the static total amount
                          document.getElementById('totalAmountStatic').style.display = 'inline';
                          // Hide the dynamic total amount
                          document.getElementById('totalAmountDynamic').style.display = 'none';
                        }


                        
                  })
                  .catch(error => {
                      console.error('Error fetching transactions:', error);
                      // Handle the error gracefully, e.g., display an error message to the user
                  });
  
          }
      });
  }
  
  
  
  </script>
  
  


<script>
  var modal = document.getElementById("myModal");
var btn = document.getElementById("openModal");
var span = document.getElementsByClassName("close")[0];

btn.onclick = function() {
  modal.style.display = "block";
}

span.onclick = function() {
  modal.style.display = "none";
}

window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>

</body>
</html>
